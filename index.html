<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ProCam Android 15</title>
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            --primary: #D3E2FF;
            --surface: #1A1C1E;
            --on-surface: #E2E2E6;
            --accent: #FFD700;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            background: #000; font-family: 'Roboto', sans-serif;
            color: white; overflow: hidden;
        }

        /* Viewfinder Area */
        .camera-container {
            position: relative;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        video {
            width: 100%;
            flex-grow: 1;
            object-fit: cover;
        }

        /* Horizon Leveler */
        #level-container {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 180px; height: 180px;
            pointer-events: none;
            display: flex; align-items: center; justify-content: center;
        }

        #horizon-line {
            width: 120px; height: 2px;
            border-top: 2px solid rgba(255,255,255,0.7);
            transition: transform 0.05s linear;
        }

        #focus-ring {
            display: none; position: absolute;
            width: 70px; height: 70px;
            border: 2px solid var(--accent);
            border-radius: 8px; pointer-events: none;
            z-index: 10;
        }

        /* Controls Layout */
        .bottom-ui {
            position: absolute; bottom: 0; width: 100%;
            padding-bottom: env(safe-area-inset-bottom);
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            display: flex; flex-direction: column; align-items: center;
        }

        .zoom-slider {
            width: 60%; margin-bottom: 20px;
            accent-color: var(--primary);
        }

        .main-controls {
            width: 100%; height: 120px;
            display: flex; justify-content: space-around; align-items: center;
        }

        #capture {
            width: 80px; height: 80px; border-radius: 50%;
            border: 5px solid white; background: transparent;
            display: flex; align-items: center; justify-content: center;
        }

        #capture::after {
            content: ""; width: 64px; height: 64px;
            background: white; border-radius: 50%;
        }

        #capture.night-active::after { background: var(--accent); }

        .btn-round {
            background: rgba(255,255,255,0.1);
            border: none; border-radius: 50%;
            color: white; width: 50px; height: 50px; font-size: 20px;
        }

        .active { background: var(--accent); color: black; }

        @keyframes focus-pulse {
            0% { transform: scale(1.4); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .focus-anim { animation: focus-pulse 0.3s ease-out forwards; }
    </style>
</head>
<body>

<div class="camera-container">
    <video id="viewfinder" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    
    <div id="focus-ring"></div>

    <div id="level-container">
        <div id="horizon-line"></div>
    </div>

    <div class="bottom-ui">
        <input type="range" id="zoom" class="zoom-slider" min="1" max="10" step="0.1" value="1">
        
        <div class="main-controls">
            <button id="night-toggle" class="btn-round">ðŸŒ™</button>
            <button id="capture"></button>
            <button id="switch" class="btn-round">ðŸ”„</button>
        </div>
    </div>
</div>

<script>
    const video = document.getElementById('viewfinder');
    const captureBtn = document.getElementById('capture');
    const zoomSlider = document.getElementById('zoom');
    const nightBtn = document.getElementById('night-toggle');
    const horizon = document.getElementById('horizon-line');
    const canvas = document.getElementById('canvas');
    
    let videoTrack = null;
    let isNightMode = false;

    async function startCamera() {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "environment", width: 1920 },
            audio: false
        });
        video.srcObject = stream;
        videoTrack = stream.getVideoTracks()[0];
        
        // Init Zoom
        const caps = videoTrack.getCapabilities();
        if(caps.zoom) {
            zoomSlider.min = caps.zoom.min;
            zoomSlider.max = caps.zoom.max;
        }
    }

    // Tap to Focus logic
    video.addEventListener('click', (e) => {
        const ring = document.getElementById('focus-ring');
        ring.style.left = `${e.clientX - 35}px`;
        ring.style.top = `${e.clientY - 35}px`;
        ring.style.display = 'block';
        ring.classList.add('focus-anim');
        
        if (navigator.vibrate) navigator.vibrate(20);
        setTimeout(() => ring.style.display = 'none', 1000);
    });

    // Horizon Leveler Logic
    window.addEventListener('deviceorientation', (e) => {
        horizon.style.transform = `rotate(${e.gamma}deg)`;
        if (Math.abs(e.gamma) < 1) horizon.style.borderColor = "#FFD700";
        else horizon.style.borderColor = "rgba(255,255,255,0.7)";
    });

    // Zoom Logic
    zoomSlider.addEventListener('input', (e) => {
        videoTrack.applyConstraints({advanced: [{zoom: e.target.value}]});
    });

    // Night Mode Toggle
    nightBtn.addEventListener('click', () => {
        isNightMode = !isNightMode;
        nightBtn.classList.toggle('active');
        captureBtn.classList.toggle('night-active');
    });

    // Capture Logic
    captureBtn.addEventListener('click', async () => {
        if (navigator.vibrate) navigator.vibrate([30]);
        
        const ctx = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        if (isNightMode) {
            // Simulated Stacking
            ctx.globalAlpha = 1.0;
            for(let i=0; i<5; i++) {
                ctx.globalCompositeOperation = i === 0 ? 'source-over' : 'lighten';
                ctx.drawImage(video, 0, 0);
                await new Promise(r => setTimeout(r, 200));
            }
        } else {
            ctx.drawImage(video, 0, 0);
        }

        const data = canvas.toDataURL('image/jpeg');
        const link = document.createElement('a');
        link.href = data;
        link.download = `ProCam_${Date.now()}.jpg`;
        link.click();
    });

    window.onload = startCamera;
</script>
</body>
</html>
